# 基于自适应风险控制的指数增强策略

刘翼 学号:51611910229

本策略的实现主要来源于《20180705-天风证券-金工专题报告：基于自适应风险控制的指数增强策略》，核心内容主要有以下三点：
 
 - **数据预处理及因子计算** ：从规模、估值、成长、盈利、技术等维度筛选出十几个具有长期稳定选股能力的因子，进行缺失值、去极值、标准化、市值和行业中性化处理。
- **收益预测模型** ：我们最后要优化的目标函数中的预期收益通过因子IR加权法计算获得，各因子权重值为各因子在滚动时间内平均IR值在所有因子在滚动时间内平均IR值之和中的占比，因子在滚动时间内平均IR值越大，说明该因子在选股时作用越大，权重也越大，反之亦然。
- **风险控制模型** ：策略的核心是控制投资组合在更多的风险因子上的暴露与基准指数一致，以期获得更小的跟踪误差。该策略需要通过求解二次优化或非线性优化问题来构建最优组合。


-------------------


## 项目各个模块代码功能说明

### 配置文件及配置文件读取
- **config.ini**
配置文件，存储了聚宽账户的**用户名**和**密码**，用于读取数据
- **config_operate.py**
 实现对上述配置文件读取
### 原始数据的获取
- get_stock.py
定义FilterStocks类，内置delete_stop函数和delete_pause函数，对于上市时间太短或者近期停牌的股票进行筛选。
输入Params：
>    - param index: 'A'全市场或者其他指数的聚宽代码，str
>    - param date: 日期，str
>    - param N: 上市日期不足N日
>    - param active_day: 过滤交易不足N日的股票
      
- functional.py
包含了所有获取数据的功能函数：
1. get_price_info
	获取指定股票池指定时间段的行情数据，在回测模块中用到
2. get_trade_period
	获取从起始日期到终止日期指定频率的日期list（以datetime的形式返回）
3. get_factor
	将4.5.6三个函数中获取到的因子的dataframe整合成一个完整的dataframe
	**三维**：证券，日期，因子
4. query_model_factor
	获取指定日期规模、估值、成长、盈利、技术等维度的因子
	**二维**：证券，因子
5. industry
	获取指定日期股票行业分类
	**二维**
6. market_cap
	获取指定日期股票市值
	**二维**
### 数据预处理
- data_preprocess.py
这部分共有四个函数：factors_null_process、extreme_process_MAD、data_scale_Z_score、neutralization，对因子数据进行了缺失值、去极值、标准化、市值和行业中性化处理。
### 模型建立
- expected_return_cal.py
这个模块用于计算基于因子IR加权法计算获得，各因子权重值为各因子在滚动时间内平均IR值在所有因子在滚动时间内平均IR值之和中的占比，因子在滚动时间内平均IR值越大，说明该因子在选股时作用越大，权重也越大，反之亦然。
1.get_next_return：计算预期收益，用于ICIR值计算
2.IR_weight：计算IR值对应权重并加入factor的dataframe返回

- weight_optimization.py
1.get_weighs：获取指数标准权重
2.get_opt_weight:根据输入限制条件优化目标函数获得最优的权重
3.optimization_result:获得最后的包含日期、证券、权重三个维度的dataframe，输入回测框架
### 策略生成主代码文件
- main.py
import 上述各个模块中的功能函数，依次运行
### 回测
- backtest.py
## 策略构造相关参数
### 交易标的及周期选取

> **股票池**：沪深300指数
> **周期**：2018/7/1 - 2021/7/31

### 因子表

|类别|因子名称|因子code|因子计算方式|
|--  | --    |    --  |--|
 |规模|对数市值|natural_log_of_market_cap|总市值取对数| 
 |估值|账面市值比|book_to_price_ratio|净资产/总市值| 
 |技术指标|一个月反转|ROC20|过去 20 个交易日涨跌幅| 
 |技术指标|三个月反转|ROC60|过去 60 个交易日涨跌幅| 
 |成长|净利润增长率|net_profit_growth_rate|(今年净利润（TTM）/去年净利润（TTM）)-1(修改)| 
 |成长|营业收入增长率|operating_revenue_growth_rate|今年营业收入（TTM）/去年营业收入（TTM））-1(修改)| 
 |成长|利润总额增长率|total_profit_growth_rate|(今年利润总额（TTM）/去年利润总额（TTM）)-1(修改)| 
 |盈利|单季度净资产收益率|roe_ttm|单季度归母净利润2/（期初归母净资产+期末归母净资产)(修改)| 
 |盈利|单季度总资产收益率|roa_ttm|单季度息税前利润2/（期初总资产+期末总资产）(修改)| 
 |流动性|一个月日均换手|VOL20|过去20个交易换手率均值| 
 |流动性|三个月日均换手|VOL60|过去60个交易换手率均值| |波动|特异度|IVR|1-过去20交易日Fama-French三因子回归拟合度(Factor)| 



